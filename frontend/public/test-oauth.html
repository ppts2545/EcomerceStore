<!DOCTYPE html>
<html>
<head>
    <title>OAuth2 Test</title>
</head>
<body>
    <h1>OAuth2 Test Page</h1>
    
    <button onclick="testOAuth()">üîê Test Google OAuth2 Login</button>
    <button onclick="testCurrentUser()">üë§ Test Current User</button>
    <button onclick="testProducts()">üì¶ Test Products</button>
    
    <div id="results" style="margin-top: 20px; white-space: pre-wrap;"></div>
    
    <script>
        async function testOAuth() {
            const results = document.getElementById('results');
            results.innerHTML = 'Starting OAuth2 test...\n';
            
            // Open OAuth2 login in popup
            const popup = window.open(
                'http://localhost:8082/oauth2/authorization/google',
                'oauth2',
                'width=500,height=600'
            );
            
            // Listen for the success message
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'OAUTH_SUCCESS') {
                    results.innerHTML += '‚úÖ OAuth2 Success!\n';
                    results.innerHTML += `Email: ${event.data.email}\n`;
                    results.innerHTML += `Name: ${event.data.name}\n`;
                    results.innerHTML += `Token: ${event.data.token ? 'Present' : 'Missing'}\n`;
                    popup.close();
                }
            });
        }
        
        async function testCurrentUser() {
            const results = document.getElementById('results');
            results.innerHTML = 'Testing current user...\n';
            
            try {
                const response = await fetch('http://localhost:8082/api/auth/me', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                results.innerHTML += `Status: ${response.status}\n`;
                results.innerHTML += `Response: ${JSON.stringify(data, null, 2)}\n`;
            } catch (error) {
                results.innerHTML += `Error: ${error.message}\n`;
            }
        }
        
        async function testProducts() {
            const results = document.getElementById('results');
            results.innerHTML = 'Testing products...\n';
            
            try {
                const response = await fetch('http://localhost:8082/api/products');
                const data = await response.json();
                results.innerHTML += `Status: ${response.status}\n`;
                results.innerHTML += `Products count: ${data.length}\n`;
                results.innerHTML += `First product: ${JSON.stringify(data[0], null, 2)}\n`;
            } catch (error) {
                results.innerHTML += `Error: ${error.message}\n`;
            }
        }
    </script>
</body>
</html>
